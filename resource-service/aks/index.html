<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Create a branded static site from a set of Markdown files to host the documentation of your Open Source or commercial project"><meta name=author content="OCTO CCoE"><link href=https://github.kyndryl.net/OCTO/azure/resource-service/aks/ rel=canonical><link rel=icon href=../../kyndryl2.png><meta name=generator content="mkdocs-1.2.2, mkdocs-material-7.3.0"><title>Azure Kubernetes Service - Kyndrl Solution Guidance for Azure Services</title><link rel=stylesheet href=../../assets/stylesheets/main.55b1b295.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CIBM+Plex+Mono&display=fallback"><style>:root{--md-text-font-family:"IBM Plex Sans";--md-code-font-family:"IBM Plex Mono"}</style><link rel=stylesheet href=../../extra.css><link rel=stylesheet href=../../extra-pagesize.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=blue> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#azure-kubernetes-service-aks class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Kyndrl Solution Guidance for Azure Services" class="md-header__button md-logo" aria-label="Kyndrl Solution Guidance for Azure Services" data-md-component=logo> <img src=../../kyndryl2.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kyndrl Solution Guidance for Azure Services </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Azure Kubernetes Service </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.kyndryl.net/OCTO/azure/issues title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> FEEDBACK/ISSUES </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../stratplan/stratplanoverview/ class=md-tabs__link> Adoption & Design </a> </li> <li class=md-tabs__item> <a href=../compute/ class="md-tabs__link md-tabs__link--active"> Azure Resources & Services </a> </li> <li class=md-tabs__item> <a href=../../lzdesignsample1/wldescription/ class=md-tabs__link> Examples - Design & Implementation </a> </li> <li class=md-tabs__item> <a href=../../automation/automation/automation-usecases/ class=md-tabs__link> Operations Automation (IN PROGRESS) </a> </li> <li class=md-tabs__item> <a href=../../about/1authors/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Kyndrl Solution Guidance for Azure Services" class="md-nav__button md-logo" aria-label="Kyndrl Solution Guidance for Azure Services" data-md-component=logo> <img src=../../kyndryl2.png alt=logo> </a> Kyndrl Solution Guidance for Azure Services </label> <div class=md-nav__source> <a href=https://github.kyndryl.net/OCTO/azure/issues title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> FEEDBACK/ISSUES </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../home/scope/ class=md-nav__link> Scope </a> </li> <li class=md-nav__item> <a href=../../home/prereq-learning/ class=md-nav__link> Pre-Requisite Learning </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Adoption & Design <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Adoption & Design" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Adoption & Design </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1> Strategy & Planning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Strategy & Planning" data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Strategy & Planning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../stratplan/stratplanoverview/ class=md-nav__link> Strategy & Planning Overview </a> </li> <li class=md-nav__item> <a href=../../stratplan/adoptionstrategy/ class=md-nav__link> Cloud Adoption Strategy </a> </li> <li class=md-nav__item> <a href=../../stratplan/adoptionplan/ class=md-nav__link> Plan </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Landing Zone Design <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Landing Zone Design" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Landing Zone Design </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lzdesign/lzdesignoverview/ class=md-nav__link> Overview & Scope </a> </li> <li class=md-nav__item> <a href=../../lzdesign/lzdesignapproach/ class=md-nav__link> Design Approach </a> </li> <li class=md-nav__item> <a href=../../lzdesign/eaenrolment/ class=md-nav__link> 1.Enterprise Enrollment </a> </li> <li class=md-nav__item> <a href=../../lzdesign/iam/ class=md-nav__link> 2.Identity & Access </a> </li> <li class=md-nav__item> <a href=../../lzdesign/orgmgmt/ class=md-nav__link> 3.Organization Mgmt </a> </li> <li class=md-nav__item> <a href=../../lzdesign/nwtopology/ class=md-nav__link> 4.Network </a> </li> <li class=md-nav__item> <a href=../../lzdesign/monitoringmgmt/ class=md-nav__link> 5.Monitoring & Mgmt </a> </li> <li class=md-nav__item> <a href=../../lzdesign/govcomp/ class=md-nav__link> 6.Governance & Compliance </a> </li> <li class=md-nav__item> <a href=../../lzdesign/bcdr/ class=md-nav__link> 7.Backup & DR </a> </li> <li class=md-nav__item> <a href=../../lzdesign/platformauto/ class=md-nav__link> 8.Platform Automation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> Automations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Automations data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Automations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../automation/automation/automation-framework.md class=md-nav__link> Automation Framework </a> </li> <li class=md-nav__item> <a href=../../automation/automation/automation-architecture/ class=md-nav__link> Automation Architecture </a> </li> <li class=md-nav__item> <a href=../../automation/automation/makemanage/ class=md-nav__link> Make Manage Automation </a> </li> <li class=md-nav__item> <a href=../../automation/automation/azure-automationoptions/ class=md-nav__link> Azure Automation Options </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> Azure LightHouse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Azure LightHouse" data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Azure LightHouse </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../automation/lighthouse/lh-enableguide/ class=md-nav__link> LightHouse Enablement </a> </li> <li class=md-nav__item> <a href=../../automation/lighthouse/lh-adminguide/ class=md-nav__link> LightHouse Administration </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Azure Resources & Services <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Azure Resources & Services" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Azure Resources & Services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../compute/ class=md-nav__link> Azure Compute </a> </li> <li class=md-nav__item> <a href=../vmagents/ class=md-nav__link> VM Agents </a> </li> <li class=md-nav__item> <a href=../storage/ class=md-nav__link> Azure Storage </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Azure Kubernetes Service <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Azure Kubernetes Service </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#aks-installation-and-operation class=md-nav__link> AKS - Installation and Operation </a> <nav class=md-nav aria-label="AKS - Installation and Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-cluster-installation class=md-nav__link> AKS Cluster Installation </a> </li> <li class=md-nav__item> <a href=#aks-cluster-dashboard class=md-nav__link> AKS Cluster Dashboard </a> </li> <li class=md-nav__item> <a href=#aks-cluster-access-via-cloudshell class=md-nav__link> AKS Cluster Access via CloudShell </a> </li> <li class=md-nav__item> <a href=#aks-cluster-upgrade class=md-nav__link> AKS Cluster Upgrade </a> </li> <li class=md-nav__item> <a href=#azure-aks-cluster-auto-scaling class=md-nav__link> Azure AKS Cluster Auto-scaling </a> </li> <li class=md-nav__item> <a href=#auto-repair-of-aks-worker-node class=md-nav__link> Auto-repair of AKS Worker Node </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-networking class=md-nav__link> AKS - Networking </a> <nav class=md-nav aria-label="AKS - Networking"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-network-overlays class=md-nav__link> AKS Network Overlays </a> </li> <li class=md-nav__item> <a href=#aks-cluster-load-balancer class=md-nav__link> AKS Cluster Load Balancer </a> <nav class=md-nav aria-label="AKS Cluster Load Balancer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#azure-load-balancer class=md-nav__link> Azure Load Balancer </a> </li> <li class=md-nav__item> <a href=#http-application-routing-add-on class=md-nav__link> HTTP Application routing Add on </a> </li> <li class=md-nav__item> <a href=#application-gateway-ingress-controller-agic class=md-nav__link> Application Gateway Ingress Controller (AGIC) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-troubleshooting class=md-nav__link> AKS - Troubleshooting </a> <nav class=md-nav aria-label="AKS - Troubleshooting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-diagnostics class=md-nav__link> AKS Diagnostics </a> </li> <li class=md-nav__item> <a href=#aks-container-insights class=md-nav__link> AKS Container Insights </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-identity-and-access-management class=md-nav__link> AKS - Identity and Access Management </a> <nav class=md-nav aria-label="AKS - Identity and Access Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-managed-azure-active-directory-integration class=md-nav__link> AKS-managed Azure Active Directory Integration </a> </li> <li class=md-nav__item> <a href=#azure-ad-pod-managed-identities-in-aks class=md-nav__link> Azure AD pod-managed identities in AKS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-security class=md-nav__link> AKS - Security </a> <nav class=md-nav aria-label="AKS - Security"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-cluster-compliance-and-threat-detection class=md-nav__link> AKS Cluster Compliance and Threat Detection </a> </li> <li class=md-nav__item> <a href=#aks-cluster-secrets-and-azure-key-vault class=md-nav__link> AKS Cluster Secrets and Azure Key Vault </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-azure-paas class=md-nav__link> AKS - Azure PaaS </a> <nav class=md-nav aria-label="AKS - Azure PaaS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#azure-service-operator-aso class=md-nav__link> Azure Service Operator (ASO) </a> </li> <li class=md-nav__item> <a href=#aks-serverless-and-azure-functions class=md-nav__link> AKS Serverless and Azure Functions </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Examples - Design & Implementation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Examples - Design & Implementation" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Examples - Design & Implementation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1> Landing Zone Design - Sample Workload 1 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Landing Zone Design - Sample Workload 1" data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Landing Zone Design - Sample Workload 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lzdesignsample1/wldescription/ class=md-nav__link> Workload Description </a> </li> <li class=md-nav__item> <a href=../../lzdesignsample1/eaenrol/ class=md-nav__link> 1.Enterprise Enrollment & Azure AD Tenants </a> </li> <li class=md-nav__item> <a href=../../lzdesignsample1/idaccess/ class=md-nav__link> 2.Identity & Access Management </a> </li> <li class=md-nav__item> <a href=../../lzdesignsample1/organdmgmt/ class=md-nav__link> 3.Organization & Management Group </a> </li> <li class=md-nav__item> <a href=../../lzdesignsample1/nwtopo/ class=md-nav__link> 4.Network Topology & Connectivity </a> </li> <li class=md-nav__item> <a href=../../lzdesignsample1/monitoringmgmt/ class=md-nav__link> 5.Monitoring & Management </a> </li> <li class=md-nav__item> <a href=../../lzdesignsample1/backupdr/ class=md-nav__link> 6.Business Continuity & Disaster Recovery </a> </li> <li class=md-nav__item> <a href=../../lzdesignsample1/govcomp/ class=md-nav__link> 7.Governance & Compliance </a> </li> <li class=md-nav__item> <a href=../../lzdesignsample1/platformauto/ class=md-nav__link> 8.Platform Automation & DevOps </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Virtual WAN - Design and Implementation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Virtual WAN - Design and Implementation" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Virtual WAN - Design and Implementation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../virtualwan/overview/ class=md-nav__link> Overview and Link to Details </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Operations Automation (IN PROGRESS) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operations Automation (IN PROGRESS)" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Operations Automation (IN PROGRESS) </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_1 type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1> Automations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Automations data-md-level=2> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> Automations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../automation/automation/automation-usecases/ class=md-nav__link> Automation UseCases </a> </li> <li class=md-nav__item> <a href=../../automation/automation/automation-architecture/ class=md-nav__link> Automation Architecture </a> </li> <li class=md-nav__item> <a href=../../automation/automation/makemanage/ class=md-nav__link> Make Manage Automation </a> </li> <li class=md-nav__item> <a href=../../automation/automation/azure-automationoptions/ class=md-nav__link> Azure Automation Options </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_2 type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2> Azure LightHouse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Azure LightHouse" data-md-level=2> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Azure LightHouse </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../automation/lighthouse/lh-enableguide/ class=md-nav__link> LightHouse Enablement </a> </li> <li class=md-nav__item> <a href=../../automation/lighthouse/lh-adminguide/ class=md-nav__link> LightHouse Administration </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> About <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=About data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/1authors/ class=md-nav__link> Contributors </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#aks-installation-and-operation class=md-nav__link> AKS - Installation and Operation </a> <nav class=md-nav aria-label="AKS - Installation and Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-cluster-installation class=md-nav__link> AKS Cluster Installation </a> </li> <li class=md-nav__item> <a href=#aks-cluster-dashboard class=md-nav__link> AKS Cluster Dashboard </a> </li> <li class=md-nav__item> <a href=#aks-cluster-access-via-cloudshell class=md-nav__link> AKS Cluster Access via CloudShell </a> </li> <li class=md-nav__item> <a href=#aks-cluster-upgrade class=md-nav__link> AKS Cluster Upgrade </a> </li> <li class=md-nav__item> <a href=#azure-aks-cluster-auto-scaling class=md-nav__link> Azure AKS Cluster Auto-scaling </a> </li> <li class=md-nav__item> <a href=#auto-repair-of-aks-worker-node class=md-nav__link> Auto-repair of AKS Worker Node </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-networking class=md-nav__link> AKS - Networking </a> <nav class=md-nav aria-label="AKS - Networking"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-network-overlays class=md-nav__link> AKS Network Overlays </a> </li> <li class=md-nav__item> <a href=#aks-cluster-load-balancer class=md-nav__link> AKS Cluster Load Balancer </a> <nav class=md-nav aria-label="AKS Cluster Load Balancer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#azure-load-balancer class=md-nav__link> Azure Load Balancer </a> </li> <li class=md-nav__item> <a href=#http-application-routing-add-on class=md-nav__link> HTTP Application routing Add on </a> </li> <li class=md-nav__item> <a href=#application-gateway-ingress-controller-agic class=md-nav__link> Application Gateway Ingress Controller (AGIC) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-troubleshooting class=md-nav__link> AKS - Troubleshooting </a> <nav class=md-nav aria-label="AKS - Troubleshooting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-diagnostics class=md-nav__link> AKS Diagnostics </a> </li> <li class=md-nav__item> <a href=#aks-container-insights class=md-nav__link> AKS Container Insights </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-identity-and-access-management class=md-nav__link> AKS - Identity and Access Management </a> <nav class=md-nav aria-label="AKS - Identity and Access Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-managed-azure-active-directory-integration class=md-nav__link> AKS-managed Azure Active Directory Integration </a> </li> <li class=md-nav__item> <a href=#azure-ad-pod-managed-identities-in-aks class=md-nav__link> Azure AD pod-managed identities in AKS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-security class=md-nav__link> AKS - Security </a> <nav class=md-nav aria-label="AKS - Security"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aks-cluster-compliance-and-threat-detection class=md-nav__link> AKS Cluster Compliance and Threat Detection </a> </li> <li class=md-nav__item> <a href=#aks-cluster-secrets-and-azure-key-vault class=md-nav__link> AKS Cluster Secrets and Azure Key Vault </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aks-azure-paas class=md-nav__link> AKS - Azure PaaS </a> <nav class=md-nav aria-label="AKS - Azure PaaS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#azure-service-operator-aso class=md-nav__link> Azure Service Operator (ASO) </a> </li> <li class=md-nav__item> <a href=#aks-serverless-and-azure-functions class=md-nav__link> AKS Serverless and Azure Functions </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=azure-kubernetes-service-aks>Azure Kubernetes Service (AKS)<a class=headerlink href=#azure-kubernetes-service-aks title="Permanent link">⚓︎</a></h1> <p>Azure Kubernetes Service (AKS) is Azure's managed service for Kubernetes. It reduces the complexity of building and managing Kubernetes clusters. </p> <p>A typical Kubernetes cluster consists of a number of master nodes that constitute the control plane and a number of worker nodes. A node within a Kubernetes cluster is equivalent to a server or a virtual machine (VM). The control plane contains the Kubernetes API and a database that persists the cluster state. The worker nodes are the compute resources that run actual workloads.</p> <p>When an AKS cluster is created, Azure sets up the master nodes and manages them. Worker nodes are created from one or more Virtual Machine Scale Sets (VMSS). The control plane can either be paid for or free depending on whether SLAs are supported or not.</p> <p>The purpose of this document is to lay out those aspects in which AKS is different from standalone Kubernetes distributions such as OpenShift and Rancher. A significant portion of the document focusses on the integration of AKS with functions/features of the Azure platform such as Load Balancers, Application Gateways, Azure Active Directory, Monitoring, and Security Center. The prominent topics in the subsequent sections are -</p> <ul> <li>AKS - Installation and Operation</li> <li>AKS - Networking</li> <li>AKS - Troubleshooting</li> <li>AKS - Identity and Access Management</li> <li>AKS - Security</li> <li>AKS - Azure PaaS</li> </ul> <h2 id=aks-installation-and-operation>AKS - Installation and Operation<a class=headerlink href=#aks-installation-and-operation title="Permanent link">⚓︎</a></h2> <p>This section covers the installation and operational aspects of AKS Clusters.</p> <h3 id=aks-cluster-installation>AKS Cluster Installation<a class=headerlink href=#aks-cluster-installation title="Permanent link">⚓︎</a></h3> <p>An AKS cluster can be created in a number of ways -</p> <ul> <li> <p>Azure portal: leverages a wizard provided via a graphical user interface (GUI) for deploying the cluster. It is not suited for automated deployment or deployment of multiple clusters.</p> </li> <li> <p>Azure CLI: This is a cross‑platform CLI for managing Azure resources. It enables automated deployment of AKS clusters via scripts.</p> </li> <li> <p>Azure PowerShell: This is a set of PowerShell commands used for managing Azure resources directly from PowerShell. It also enables automated deployment of AKS clusters via PowerShell scripts.</p> </li> <li> <p>ARM templates: Azure Resource Manager (ARM) templates are an Azure‑native way to deploy Azure resources using Infrastructure as Code (IaC). An ARM template supports the declarative and parameterized definition of an AKS cluster that can be reused to create consistent cluster instances.</p> </li> <li> <p>Terraform for Azure: Terraform is an open-source IaC tool developed by HashiCorp and supports deployment of resources in a number of cloud platforms including Azure. Like ARM templates, Terraform supports the declarative and parameterized definition of an AKS cluster that can be reused to create consistent cluster instances.</p> </li> </ul> <p>More detailed information on installation is provided in the section titled "Deploy an AKS Cluster" at <a href=https://docs.microsoft.com/azure/aks>https://docs.microsoft.com/azure/aks</a>.</p> <h3 id=aks-cluster-dashboard>AKS Cluster Dashboard<a class=headerlink href=#aks-cluster-dashboard title="Permanent link">⚓︎</a></h3> <p>Azure portal provides a dashboard for each AKS cluster. A search for "AKS" through the "Search resources" facility in the Azure portal lists all the AKS instances. Selecting one cluster brings up the dashboard for that cluster. The dashboard serves as a single pane of glass for the cluster providing functions such as -</p> <ul> <li>Cluster Settings - covers node pools, cluster configuration, networking, identity, role based access control, policies</li> <li>Management of Kubernetes resources - covers deployments, namespaces, config maps, secrets, storage, services and ingresses</li> <li>Monitoring - covers Metrics, Logs, Alerts, Insights, Diagnostic settings and pre-built workbooks to display custom views of the metric data</li> <li>Miscellaneous - view activity logs, identity/role lifecycle, security, support and automation</li> </ul> <p>More details on the Azure AKS Dashboard are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/kubernetes-dashboard>https://docs.microsoft.com/en-us/azure/aks/kubernetes-dashboard</a>.</p> <h3 id=aks-cluster-access-via-cloudshell>AKS Cluster Access via CloudShell<a class=headerlink href=#aks-cluster-access-via-cloudshell title="Permanent link">⚓︎</a></h3> <p>Azure provides, as a convenience, a command-line interface (Bash or Powershell) that can be used to connect to and operate AKS cluster instances. This is called Cloudshell and is accessible on the Azure portal as shown below -</p> <p><img style=height:30%;width:60% src=../images/aks-cloudshell.png></p> <p>The first time CloudShell is launched, the following steps need to be performed one time -</p> <ul> <li>a storage account (either existing or new) needs to be associated with it in order to provide a file share to which files can be persisted for future sessions of CloudShell. </li> <li>Credentials for accessing the AKS cluster need to be obtained. For the bash shell the following command can be used - az aks get-credentials --resource-group \&lt;rg-name> --name \&lt;aks-cluster-name></li> </ul> <p>Now on, kubectl can be used, just like with any Kubernetes cluster, to operate the AKS cluster. CloudShell comes with kubectl pre-installed.</p> <h3 id=aks-cluster-upgrade>AKS Cluster Upgrade<a class=headerlink href=#aks-cluster-upgrade title="Permanent link">⚓︎</a></h3> <p>The upgrade of the AKS cluster can be performed from the AKS Cluster dashboard. The control plane needs to be first upgraded using the "Cluster configuration" pane. Then the worker nodes can be upgraded using the "Node pools" pane. More details on the upgrade process are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/upgrade-cluster>https://docs.microsoft.com/en-us/azure/aks/upgrade-cluster</a>.</p> <h3 id=azure-aks-cluster-auto-scaling>Azure AKS Cluster Auto-scaling<a class=headerlink href=#azure-aks-cluster-auto-scaling title="Permanent link">⚓︎</a></h3> <p>It is possible for an AKS cluster to be scaled up and down automatically depending on the resources available to create new workloads. For example, if the Kubernetes control plane is unable to create the required pods due to lack of resources within the AKS cluster, the cluster autoscaler can be configured to add more worker nodes to the AKS cluster. As and when workloads finish or deleted and resources become available worker nodes can be removed from the AKS cluster.</p> <p>More details on cluster autoscaling are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/cluster-autoscaler>https://docs.microsoft.com/en-us/azure/aks/cluster-autoscaler</a>.</p> <h3 id=auto-repair-of-aks-worker-node>Auto-repair of AKS Worker Node<a class=headerlink href=#auto-repair-of-aks-worker-node title="Permanent link">⚓︎</a></h3> <p>An AKS cluster continuously monitors the health of worker nodes and leverages Azure VMs to automatically repair a node if it not healthy. More details on this feature are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/node-auto-repair>https://docs.microsoft.com/en-us/azure/aks/node-auto-repair</a>.</p> <h2 id=aks-networking>AKS - Networking<a class=headerlink href=#aks-networking title="Permanent link">⚓︎</a></h2> <p>This section covers the networking aspects of AKS clusters.</p> <h3 id=aks-network-overlays>AKS Network Overlays<a class=headerlink href=#aks-network-overlays title="Permanent link">⚓︎</a></h3> <p>Azure provides two options for network overlays that will provide network connectivity for the pods hosted in AKS clusters. </p> <p>One option is Kubenet wherein a virtual network and subnet are created for an AKS cluster. The nodes of the AKS cluster are given IP addresses from this virtual network and subnet while pods within the AKS cluster use a completely different IP address range. Traffic The diagram below exemplifies how pods are assigned IP addresses and communicate with one another and the external world. <img style=height:30%;width:60% src=../images/aks-kubenet.png></p> <p>As can be seen above, Node 1 above assigns pods addresses from the 10.244.0.0/24 range while Node 2 does the same from the 10.244.2.0/24 range. For traffic from Pod 1 to Pod 3, User-Defined Routes (UDRs) are created in Node 1 that route the traffic between the nodes and vice versa. Traffic between pods and VMs (and all other entities external to the AKS cluster) can only be initiated at the pod and is source-NATed to the IP address of the source node. More details on the use of Kubenet in Azure AKS are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/configure-kubenet>https://docs.microsoft.com/en-us/azure/aks/configure-kubenet</a>.</p> <p>The other option is Azure CNI wherein pods are assigned IP addresses from the same ranges as the AKS cluster nodes themselves. The benefit from this approach is the support two-way initiations of communications between pods and VMs. The drawback is the extra planning required to make sure adequate addresses are available as containers are created and deleted. More details on the use of Azure CNI in Azure AKS are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/configure-azure-cni>https://docs.microsoft.com/en-us/azure/aks/configure-azure-cni</a>.</p> <h3 id=aks-cluster-load-balancer>AKS Cluster Load Balancer<a class=headerlink href=#aks-cluster-load-balancer title="Permanent link">⚓︎</a></h3> <p>There are three possible options for load balancing traffic from outside the AKS cluster.</p> <h4 id=azure-load-balancer>Azure Load Balancer<a class=headerlink href=#azure-load-balancer title="Permanent link">⚓︎</a></h4> <p>This is an L4 Load Balancer that is created by Azure when a workload is exposed via a Kubernetes Service of type LoadBalancer. For every workload and associated Service, a public IP address, front end, load balancing rules and backend pools are created. For services that are configured for access only from within Azure networks, an internal load balancer with a private IP address instead of a public IP address is created.</p> <p>The Azure Load Balancer basically distributes the incoming requests across the worker nodes of the AKS cluster using the Nodeport feature of Kubernetes. The kube-proxy component within each worker node does further load balancing within the cluster.</p> <p>The Azure Load Balancer does not perform any filtering, SSL offloading, cookie-based affinity, URL routing or application-level firewalling.</p> <p>More details on the Azure Load Balancer for AKS are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/load-balancer-standard>https://docs.microsoft.com/en-us/azure/aks/load-balancer-standard</a>.</p> <h4 id=http-application-routing-add-on>HTTP Application routing Add on<a class=headerlink href=#http-application-routing-add-on title="Permanent link">⚓︎</a></h4> <p>This consists of two components -</p> <ul> <li>An external DNS controller that watches for new ingress rules and creates A records in a cluster-specific DNS zone that is external to the cluster.</li> <li>An Nginx Ingress controller that consists of an Azure Load Balancer Service and an Nginx deployment that is configured with L7 load balancing rules as and when ingress rules are created within AKS.</li> </ul> <p>As external traffic for a particular application deployed in AKS arrives at a site, it is directed via DNS resolution to the Azure Load Balancer which load balances the traffic across the Nginx servers. The Nginx servers use the HTTP headers in the requests and the configured ingress rules to direct the traffic to a suitable pod in the AKS cluster.</p> <p>The addon supports functions such as SSL termination, cookie-based affinity and URL based forwarding.</p> <p>The addon needs to be enabled for the cluster by running the following command in CloudShell -</p> <p>az aks enable-addons --resource-group \&lt;rg-for-AKS-cluster> --name \&lt;AKS-cluster-name> --addons http_application_routing.</p> <p>The purpose of this addon is to quickly create an ingress controller for testing applications. It is not meant for production environments.</p> <p>More details on this add-on are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/http-application-routing>https://docs.microsoft.com/en-us/azure/aks/http-application-routing</a>.</p> <h4 id=application-gateway-ingress-controller-agic>Application Gateway Ingress Controller (AGIC)<a class=headerlink href=#application-gateway-ingress-controller-agic title="Permanent link">⚓︎</a></h4> <p>The AGIC is the native ingress controller for AKS. It integrates the Azure Application Gateway into an AKS cluster to support the ingress controller functionality. Either an existing or a new Application Gateway instance can be used for the purpose. A new Application Gateway instance can be integrated into an AKS cluster using the following command in CloudShell -</p> <p>az aks enable-addons --resource-group \&lt;rg-for-AKS-cluster> --name \&lt;AKS-cluster-name> -a ingress-appgw --appgw-subnet-cidr \&lt;appgw-subnet> --appgw-name \&lt;app-gw-name></p> <p>When an ingress rule is created, the Application Gateway instance integrated into the AKS cluster is configured to load balance traffic for the associated application across the requisite set of pods in the cluster. The Fully Qualified Domain Name (FQDN) for an application needs to be manually configured in an external DNS zone with resolution pointing to the IP address of the integrated Application Gateway instance.</p> <p>As external traffic for a particular application deployed in AKS arrives at a site, it is directed via DNS resolution to the Application Gateway instance which in turn uses the HTTP headers in the requests and the configured ingress rules to direct the traffic to a suitable pod in the AKS cluster.</p> <p>In addition to functions such as URL routing, cookie-based affinity and SSL termination, the AGIC provides web application firewall functions and lower latency. It is the recommended method to access applications running in AKS clusters. Other ingress controllers such as nginx, Traefik, HAProxy can be used where functionality such as canary deployments and more flexible load balancing strategies are required.</p> <p>More details on the AGIC are provided at <a href=https://docs.microsoft.com/en-us/azure/application-gateway/ingress-controller-overview>https://docs.microsoft.com/en-us/azure/application-gateway/ingress-controller-overview</a>.</p> <h2 id=aks-troubleshooting>AKS - Troubleshooting<a class=headerlink href=#aks-troubleshooting title="Permanent link">⚓︎</a></h2> <p>This section discusses troubleshooting and monitoring procedures for AKS clusters.</p> <h3 id=aks-diagnostics>AKS Diagnostics<a class=headerlink href=#aks-diagnostics title="Permanent link">⚓︎</a></h3> <p>When experiencing issues with Azure AKS, a good place to start troubleshooting is the "AKS Diagnose and solve problems" option available via the AKS Dashboard. When this option is selected a choice of "Cluster Insights" and "Networking" is presented. Cluster Insights uses cluster logs and the cluster configuration to perform a health check and compare the cluster against best practices. It contains useful information and relevant health indicators in case anything is misconfigured in the cluster. The Networking section of AKS Diagnostics allows interactive troubleshooting of networking issues in the cluster. It presents several possible areas for troubleshooting. Selection of any area will then trigger network health checks and configuration reviews and provide helpful insights.</p> <p>More details on AKS Diagnostics are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/concepts-diagnostics>https://docs.microsoft.com/en-us/azure/aks/concepts-diagnostics</a>.</p> <h3 id=aks-container-insights>AKS Container Insights<a class=headerlink href=#aks-container-insights title="Permanent link">⚓︎</a></h3> <p>This is different from the Cluster Insights described above in the sense it is more focused on the presenting different views and analysis of metrics and logs from the AKS cluster to gain deeper insights in the cluster behavior. It needs to be enabled on an AKS cluster that results in the collection of metrics and logs by a containerized version of the Log Analytics agent and aggregation of the same into a Log Analytics workspace. The agent leverages Kubernetes APIs to extract the data from the AKS cluster. Cluster Insights then provides the following functions based on the data stored in the Log Analytics workspace -</p> <ul> <li>Cluster Metrics - displays CPU utilization and the memory utilization of all the nodes in the cluster. Optionally additional filters can be added to filter to a particular namespace, node, or node pool. There also is a live option, which provides more real-time information on your cluster status.</li> <li>Reports - A number of pre-configured monitoring workbooks are provided that combine text, log queries, metrics and parameters to display rich interactive reports. </li> <li>Nodes - displays detailed metrics for the AKS cluster nodes as also the location of the various pods running in the AKS cluster. Event logs from the nodes can be viewed as well.</li> <li>Controllers - displays details on all the Kubernetes controllers (ReplicaSets, DaemonSets, StatefulSets, and others) and the pods running within them.</li> <li>Containers - displays the metrics, logs, and environment variables for a container.</li> <li>Deployments - displays the details of all the deployments in an AKS cluster.</li> </ul> <p>More details on AKS Container Insights is provided at <a href=https://docs.microsoft.com/en-us/azure/azure-monitor/containers/container-insights-overview>https://docs.microsoft.com/en-us/azure/azure-monitor/containers/container-insights-overview</a>.</p> <h2 id=aks-identity-and-access-management>AKS - Identity and Access Management<a class=headerlink href=#aks-identity-and-access-management title="Permanent link">⚓︎</a></h2> <p>This section covers the integration of AKS clusters with Azure for identity and access management.</p> <h3 id=aks-managed-azure-active-directory-integration>AKS-managed Azure Active Directory Integration<a class=headerlink href=#aks-managed-azure-active-directory-integration title="Permanent link">⚓︎</a></h3> <p>Kubernetes clusters leverage authentication plugins to various authentication mechanisms (certificates, bearer tokens, HTTP basic authorization, file based userid-password) to perform authentication of users. AKS however, supports Azure Active Directory (AAD) in addition to all these. Azure users can thus use both the Azure platform and AKS clusters hosted within that platform using the same user-id. However, the Role-based Access Control is separate across the Azure platform and AKS cluster. It is therefore necessary to create roles and authorization rules separately for both. More details on AKS-managed AAD Integration is provided at <a href=https://docs.microsoft.com/en-us/azure/aks/managed-aad>https://docs.microsoft.com/en-us/azure/aks/managed-aad</a>.</p> <h3 id=azure-ad-pod-managed-identities-in-aks>Azure AD pod-managed identities in AKS<a class=headerlink href=#azure-ad-pod-managed-identities-in-aks title="Permanent link">⚓︎</a></h3> <p>Managed identities in Azure are used by applications or Azure functions running in VMs to authenticate to Azure AD and obtain authorization to access other resources. Azure supports two types of managed identities -</p> <ul> <li>System assigned - This type of managed identity is dedicated to one resource such as a VM. Its lifecycle is identical to that of the resource, which means it is deleted along with the resource.</li> <li>User assigned - this type of managed identity has its own lifecycle and can be shared by multiple resources.</li> </ul> <p>A managed identity is passed to Azure AD through a special endpoint called the Instance Metadata Service (IMDS) which uses a certificate configured for that managed identity. This results in a token being returned to the requestor that can be used to authenticate to other resources and authorize their use. Managed identities are easier to manage than service principals and therefore, the recommended approach for the authentication and authorization of applications that need access to other Azure resources.</p> <p>Note that VMs can be configured with managed identities which, by default, could be used by the multiple pods running in that VM. The Azure AD pod-managed identities add-on for AKS configures the AKS cluster such that pods can no longer access the IMDS endpoint directly. Instead all pods trying to access this endpoint connect to a DaemonSet called the Node Managed Identity (NMI) which validates the pod request then leverages the IMDS to acquire a token and return it to the requesting pod.</p> <p>More details on this feature are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/use-managed-identity>https://docs.microsoft.com/en-us/azure/aks/use-managed-identity</a>.</p> <h2 id=aks-security>AKS - Security<a class=headerlink href=#aks-security title="Permanent link">⚓︎</a></h2> <p>This section covers the integration of AKS clusters with Azure for security services.</p> <h3 id=aks-cluster-compliance-and-threat-detection>AKS Cluster Compliance and Threat Detection<a class=headerlink href=#aks-cluster-compliance-and-threat-detection title="Permanent link">⚓︎</a></h3> <p>Azure Policy is a service that helps to enforce organizational standards and to assess compliance at-scale. For Kubernetes and specifially AKS, Azure Policy leverages a tool called Gatekeeper which functions as an Admission Controller webhook for an AKS cluster. All authentication requests and Kubernetes API calls are intercepted and sent to GateKeeper. Gatekeeper in turn uses a tool Open Policy Agent (OPA) to detect actions that are non-compliant with set policies and report to Azure Policy. OPA also watches for instances of Custom Resource Definitions (CRDs) that define policies and for non-compliance by standard Kubernetes resources. Azure Policy needs to be enabled in order for policies to be assigned to the AKS cluster and for the Admission Controller webhook to be established. More details on Azure Policy for AKS are provided at <a href=https://docs.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes>https://docs.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes</a>.</p> <p>Azure Defender provides threat detection capabilities for AKS clusters by monitoring logs and behavior patterns. More details on Azure Defender for AKS are provided at <a href=https://docs.microsoft.com/en-us/azure/security-center/defender-for-kubernetes-introduction>https://docs.microsoft.com/en-us/azure/security-center/defender-for-kubernetes-introduction</a>.</p> <h3 id=aks-cluster-secrets-and-azure-key-vault>AKS Cluster Secrets and Azure Key Vault<a class=headerlink href=#aks-cluster-secrets-and-azure-key-vault title="Permanent link">⚓︎</a></h3> <p>Secrets in Kubernetes are used to hold sensitive information such as passwords or connection strings. Secrets are held in the persistent store used by the Kubernetes control plane and are unencrypted by default. Any one with access to the Kubernetes API or the persistent store can read secrets. Also any one with the ability to create pods in a Kubernetes namespace can read secrets in that namespace. For AKS clusters, Azure Key Vault provides a more secure way of working with secrets. This approach relies on a Container Storage Interface (CSI) driver that enables mounting of secrets as volumes. Typical steps to leverage Key Vault in AKS clusters are -</p> <ul> <li>Set up the CSI Driver for Key Vault in the AKS cluster</li> <li>Create a user assigned managed identity that will control access to a Key Vault instance</li> <li>Create a Key Vault instance</li> <li>Bind the user assigned managed identity to the Key Vault instance. This gives all resources that are given this managed identity permissions to operate the Key Vault instance</li> <li>Assign the user assigned managed identity to the resources that need access to secrets in the Key Vault instance</li> </ul> <p>More details on use of Azure Key Vault for AKS secrets are provided at <a href=https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-driver>https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-driver</a>.</p> <h2 id=aks-azure-paas>AKS - Azure PaaS<a class=headerlink href=#aks-azure-paas title="Permanent link">⚓︎</a></h2> <p>This section covers the use of Azure PaaS services by AKS clusters.</p> <h3 id=azure-service-operator-aso>Azure Service Operator (ASO)<a class=headerlink href=#azure-service-operator-aso title="Permanent link">⚓︎</a></h3> <p>Azure provides many managed services, database services being one. The benefit to using these services is that aspects such scalability, security, high availability, disaster recovery and backup are all taken care as part of the managed service. Therefore it is beneficial for all workloads, including those running in AKS clusters, to leverage these managed services. ASO is a Kubernetes Operator for AKS clusters that provisions Azure services and connects applications running within an AKS cluster to these services. A Kubernetes Operator is basically a way to extend the Kubernetes APIs with custom resources and consists of two components -</p> <ul> <li>A Custom Resource Definition (CRD) that can be used to instantiate a custom resource in the AKS Cluster. In case of ASO, each custom resource represents one instance of an Azure service that can be managed like any other Kubernetes resource.</li> <li>A Controller that watches for the creation/changes/deletion of these custom resources and takes suitable action. In the case of ASO, it interacts with the Azure API to create/modify/delete the associated Azure resources. The Controller for ASO needs to be linked to a managed-identity that has permissions to create resources in Azure.</li> </ul> <p>In addition, the ASO Controller may leverage Key Vaults to hold secrets such as connection strings for databases.</p> <p>More details on ASO are provided at <a href=https://github.com/Azure/azure-service-operator>https://github.com/Azure/azure-service-operator</a>.</p> <h3 id=aks-serverless-and-azure-functions>AKS Serverless and Azure Functions<a class=headerlink href=#aks-serverless-and-azure-functions title="Permanent link">⚓︎</a></h3> <p>Serverless refers to an environment for a workload where servers need not be managed. Resources are consumed only when there is work to be done. Also the environment scales automatically with the workload.</p> <p>AKS clusters can support serverless environments using Azure Functions. This service consists of two components - the Functions runtime and the Kubernetes-based Event Driven Autoscaling scale controller. The latter monitors the rate at which events are arriving at a function and scales the function appropriately. In addition, a Container Registry to hold the images for the Azure Functions will be required.</p> <p>More details on use of Azure Functions with AKS are provided at <a href=https://docs.microsoft.com/en-us/azure/azure-functions/functions-kubernetes-keda>https://docs.microsoft.com/en-us/azure/azure-functions/functions-kubernetes-keda</a>.</p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../storage/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Azure Storage" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Azure Storage </div> </div> </a> <a href=../../lzdesignsample1/wldescription/ class="md-footer__link md-footer__link--next" aria-label="Next: Workload Description" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Workload Description </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> <a href=/about/ >Copyright (C) 2021 Kyndryl</a>. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.kyndryl.net/OCTO/azure/ target=_blank rel=noopener title="FEEDBACK & ISSUES" class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tabs.link", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.8697d190.min.js></script> </body> </html>